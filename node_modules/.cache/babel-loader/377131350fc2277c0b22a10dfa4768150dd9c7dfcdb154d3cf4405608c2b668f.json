{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport { auth, database } from '../firebaseConfig';\nimport Login from '../views/auth/Login.vue';\nimport Register from '../views/auth/Register.vue';\nimport Home from '../views/Home.vue';\nimport createCrowdfundingEvent from '../views/crowdFund/admin/createCrowdfundingEvent.vue';\nimport Crowdfunding from '../views/crowdFund/user/crowdfundingMain.vue';\nimport CrowdfundCheckout from '../views/crowdFund/user/crowdfundCheckout.vue';\nimport SuccessCrowdfund from \"@/views/crowdFund/user/SuccessCrowdfund.vue\";\nimport ErrorCrowdfund from \"@/views/crowdFund/user/ErrorCrowdfund.vue\";\nimport approveFoodEve from '../views/foodDona/admin/approveFoodEve.vue';\nimport profile from '../views/auth/profile.vue';\nimport myDonations from '../views/myDonations.vue';\nimport deliveryDriverCreation from '../views/foodDona/admin/createDeliveryDriver.vue';\nimport approveGroupRequest from '../views/foodDona/user/groupDonations/approveGroupRequest.vue';\nimport ImageUpload from '../views/foodDona/admin/ImageUpload.vue';\nconst routes = [{\n  path: '/auth/login',\n  name: 'login',\n  component: Login,\n  meta: {\n    requiresAuth: false\n  }\n}, {\n  path: '/auth/register',\n  name: 'Register',\n  component: Register,\n  meta: {\n    requiresAuth: false\n  }\n}, {\n  path: '/myDonations',\n  name: \"myDonations\",\n  component: myDonations,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/',\n  name: 'Home',\n  component: Home\n}, {\n  path: '/aboutUs',\n  name: 'aboutUs',\n  component: aboutUs\n}, {\n  path: '/auth/profile',\n  name: 'Profile',\n  component: profile,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/foodeve/creation',\n  name: 'createEvent',\n  component: createEvent,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodeve/trending',\n  name: 'foodEventsTrending',\n  component: trendingEvents,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/foodeve/:id',\n  name: \"foodEvent\",\n  component: FoodEvent,\n  // children: [\n  //     {\n  //         path: 'groupDonation/create',\n  //         name: 'createGroupDonation',\n  //         component: CreateGroupDonation,\n  //     }\n  // ],\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/search',\n  name: 'Search',\n  component: Search,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding',\n  name: 'Crowdfunding',\n  component: Crowdfunding,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/:id',\n  name: \"CrowdfundCheckout\",\n  component: CrowdfundCheckout,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/:id/success',\n  name: \"SuccessCrowdfund\",\n  component: SuccessCrowdfund,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/error',\n  name: \"ErrorCrowdfund\",\n  component: ErrorCrowdfund,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/creation',\n  name: 'createCrowdfundingEvent',\n  component: createCrowdfundingEvent,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodeve/approve',\n  name: 'approveFoodDonation',\n  component: approveFoodEve,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodbank/delivery/create',\n  name: 'createDeliveryDriver',\n  component: deliveryDriverCreation,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodeve/groupDonations/approve',\n  name: 'approveGroupRequestComponent',\n  component: approveGroupRequest,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/test',\n  name: 'test',\n  component: ImageUpload,\n  meta: {\n    requiresAuth: true\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\n  const requiredRole = to.meta.requiredRole;\n  auth.onAuthStateChanged(user => {\n    if (requiresAuth && !user) {\n      // If the route requires authentication and the user is not logged in, redirect to the login page\n      next('/auth/login');\n    } else {\n      if (requiredRole && user) {\n        const userRef = ref(database, `users/${user.uid}/role`);\n        get(userRef).then(snapshot => {\n          const userRole = snapshot.val();\n          //console.log(\"User Role from Database:\", userRole);\n          if (userRole !== requiredRole) {\n            //console.log(\"User doesn't have the required role, redirecting.\");\n            next('/');\n          } else {\n            //console.log(\"User has the required role, proceeding to the route.\");\n            next();\n          }\n        }).catch(error => {\n          //console.error(\"Error fetching user role:\", error);\n          next('/');\n        });\n      } else {\n        //console.log(\"No required role or no user role defined, proceeding to the route.\");\n        next();\n      }\n    }\n  });\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","auth","database","Login","Register","Home","createCrowdfundingEvent","Crowdfunding","CrowdfundCheckout","SuccessCrowdfund","ErrorCrowdfund","approveFoodEve","profile","myDonations","deliveryDriverCreation","approveGroupRequest","ImageUpload","routes","path","name","component","meta","requiresAuth","requiredRole","aboutUs","createEvent","trendingEvents","FoodEvent","Search","router","history","beforeEach","to","from","next","matched","some","record","onAuthStateChanged","user","userRef","ref","uid","get","then","snapshot","userRole","val","catch","error"],"sources":["/Users/junyi/Documents/petadopt/src/routes/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router';\nimport { auth, database } from '../firebaseConfig';\nimport Login from '../views/auth/Login.vue';\nimport Register from '../views/auth/Register.vue';\nimport Home from '../views/Home.vue';\n\n\nimport createCrowdfundingEvent from '../views/crowdFund/admin/createCrowdfundingEvent.vue'\nimport Crowdfunding from '../views/crowdFund/user/crowdfundingMain.vue'\nimport CrowdfundCheckout from '../views/crowdFund/user/crowdfundCheckout.vue'\nimport SuccessCrowdfund from \"@/views/crowdFund/user/SuccessCrowdfund.vue\";\nimport ErrorCrowdfund from \"@/views/crowdFund/user/ErrorCrowdfund.vue\";\n\nimport approveFoodEve from '../views/foodDona/admin/approveFoodEve.vue';\nimport profile from  '../views/auth/profile.vue';\nimport myDonations from '../views/myDonations.vue';\nimport deliveryDriverCreation from '../views/foodDona/admin/createDeliveryDriver.vue';\nimport approveGroupRequest from '../views/foodDona/user/groupDonations/approveGroupRequest.vue';\nimport ImageUpload from '../views/foodDona/admin/ImageUpload.vue';\n\n\n\nconst routes = [\n    {\n        path: '/auth/login',\n        name: 'login',\n        component: Login,\n        meta: { requiresAuth: false },\n    },\n    {\n        path: '/auth/register',\n        name: 'Register',\n        component: Register,\n        meta: { requiresAuth: false },\n    },\n    {\n        path: '/myDonations',\n        name: \"myDonations\",\n        component: myDonations,\n        meta: { requiresAuth: true, requiredRole: 'user'},\n    },\n    {\n        path: '/',\n        name: 'Home',\n        component: Home,\n    },\n    {\n        path: '/aboutUs',\n        name: 'aboutUs',\n        component: aboutUs,\n\n    },\n    {\n        path: '/auth/profile',\n        name: 'Profile',\n        component: profile,\n        meta: { requiresAuth: true }\n    },\n    {\n        path: '/foodeve/creation',\n        name: 'createEvent',\n        component: createEvent,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodeve/trending',\n        name: 'foodEventsTrending',\n        component: trendingEvents,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/foodeve/:id',\n        name: \"foodEvent\",\n        component: FoodEvent,\n        // children: [\n        //     {\n        //         path: 'groupDonation/create',\n        //         name: 'createGroupDonation',\n        //         component: CreateGroupDonation,\n        //     }\n        // ],\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/search',\n        name: 'Search',\n        component: Search,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding',\n        name: 'Crowdfunding',\n        component: Crowdfunding,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/:id',\n        name: \"CrowdfundCheckout\",\n        component: CrowdfundCheckout,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/:id/success',\n        name: \"SuccessCrowdfund\",\n        component: SuccessCrowdfund,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/error',\n        name: \"ErrorCrowdfund\",\n        component: ErrorCrowdfund,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/creation',\n        name: 'createCrowdfundingEvent',\n        component: createCrowdfundingEvent,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodeve/approve',\n        name: 'approveFoodDonation',\n        component: approveFoodEve,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodbank/delivery/create',\n        name: 'createDeliveryDriver',\n        component: deliveryDriverCreation,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodeve/groupDonations/approve',\n        name: 'approveGroupRequestComponent',\n        component: approveGroupRequest,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/test',\n        name: 'test',\n        component: ImageUpload,\n        meta: { requiresAuth: true },\n    }\n]\n\n\nconst router = createRouter({ \n    history: createWebHistory(),\n    routes\n})\n\nrouter.beforeEach((to, from, next) => {\n    const requiresAuth = to.matched.some((record) => record.meta.requiresAuth);\n    const requiredRole = to.meta.requiredRole;\n    auth.onAuthStateChanged((user) => {\n        if (requiresAuth && !user) {\n            // If the route requires authentication and the user is not logged in, redirect to the login page\n            next('/auth/login');\n        } else {\n            if (requiredRole && user) {\n                const userRef = ref(database, `users/${user.uid}/role`);\n                get(userRef).then((snapshot) => {\n                    const userRole = snapshot.val();\n                    //console.log(\"User Role from Database:\", userRole);\n                    if (userRole !== requiredRole) {\n                        //console.log(\"User doesn't have the required role, redirecting.\");\n                        next('/');\n                    } else {\n                        //console.log(\"User has the required role, proceeding to the route.\");\n                        next();\n                    }\n                }).catch((error) => {\n                    //console.error(\"Error fetching user role:\", error);\n                    next('/');\n                });\n            } else {\n                //console.log(\"No required role or no user role defined, proceeding to the route.\");\n                next();\n            }\n        }\n    });\n})\n\n\nexport default router"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}