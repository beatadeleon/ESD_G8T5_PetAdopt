{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport { auth, database } from '../firebaseConfig';\nimport Login from '../auth/login';\nimport RegisterComponent from '../auth/register';\nimport { ref, get } from 'firebase/database';\nconst routes = [{\n  path: '/auth/login',\n  name: 'login',\n  component: Login,\n  meta: {\n    requiresAuth: false\n  }\n}, {\n  path: '/auth/register',\n  name: 'Register',\n  component: RegisterComponent,\n  meta: {\n    requiresAuth: false\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\n  const requiredRole = to.meta.requiredRole;\n  auth.onAuthStateChanged(user => {\n    if (requiresAuth && !user) {\n      // If the route requires authentication and the user is not logged in, redirect to the login page\n      next('/auth/login');\n    } else {\n      if (requiredRole && user) {\n        const userRef = ref(database, `users/${user.uid}/role`);\n        get(userRef).then(snapshot => {\n          const userRole = snapshot.val();\n          if (userRole !== requiredRole) {\n            // Redirect only if the user has a role and it doesn't match the required role\n            next('/'); // Redirect to the homepage or another appropriate route\n          } else {\n            next(); // Proceed to the route\n          }\n        }).catch(error => {\n          console.error(\"Error fetching user role:\", error);\n          next('/');\n        });\n      } else {\n        next(); // Proceed to the route\n      }\n    }\n  });\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","auth","database","Login","RegisterComponent","ref","get","routes","path","name","component","meta","requiresAuth","router","history","beforeEach","to","from","next","matched","some","record","requiredRole","onAuthStateChanged","user","userRef","uid","then","snapshot","userRole","val","catch","error","console"],"sources":["/Users/junyi/Documents/petadopt/src/routes/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router';\nimport { auth, database } from '../firebaseConfig';\nimport Login from '../auth/login';\nimport RegisterComponent from '../auth/register';\n\nimport { ref, get } from 'firebase/database'\n\n\n\n\nconst routes = [\n    {\n        path: '/auth/login',\n        name: 'login',\n        component: Login,\n        meta: { requiresAuth: false },\n    },\n    {\n        path: '/auth/register',\n        name: 'Register',\n        component: RegisterComponent,\n        meta: { requiresAuth: false },\n    },\n  \n]\n\n\nconst router = createRouter({ \n    history: createWebHistory(),\n    routes\n})\n\nrouter.beforeEach((to, from, next) => {\n    const requiresAuth = to.matched.some((record) => record.meta.requiresAuth);\n    const requiredRole = to.meta.requiredRole;\n    auth.onAuthStateChanged((user) => {\n        if (requiresAuth && !user) {\n            // If the route requires authentication and the user is not logged in, redirect to the login page\n            next('/auth/login');\n        } else {\n            if (requiredRole && user) {\n                const userRef = ref(database, `users/${user.uid}/role`);\n                get(userRef).then((snapshot) => {\n                    const userRole = snapshot.val();\n                    if (userRole !== requiredRole) {\n                        // Redirect only if the user has a role and it doesn't match the required role\n                        next('/'); // Redirect to the homepage or another appropriate route\n                    } else {\n                        next(); // Proceed to the route\n                    }\n                }).catch((error) => {\n                    console.error(\"Error fetching user role:\", error);\n                    next('/');\n                });\n            } else {\n                next(); // Proceed to the route\n            }\n        }\n    });\n});\n\n\n\nexport default router"],"mappings":"AAAA,SAASA,YAAY,EAAEC,gBAAgB,QAAQ,YAAY;AAC3D,SAASC,IAAI,EAAEC,QAAQ,QAAQ,mBAAmB;AAClD,OAAOC,KAAK,MAAM,eAAe;AACjC,OAAOC,iBAAiB,MAAM,kBAAkB;AAEhD,SAASC,GAAG,EAAEC,GAAG,QAAQ,mBAAmB;AAK5C,MAAMC,MAAM,GAAG,CACX;EACIC,IAAI,EAAE,aAAa;EACnBC,IAAI,EAAE,OAAO;EACbC,SAAS,EAAEP,KAAK;EAChBQ,IAAI,EAAE;IAAEC,YAAY,EAAE;EAAM;AAChC,CAAC,EACD;EACIJ,IAAI,EAAE,gBAAgB;EACtBC,IAAI,EAAE,UAAU;EAChBC,SAAS,EAAEN,iBAAiB;EAC5BO,IAAI,EAAE;IAAEC,YAAY,EAAE;EAAM;AAChC,CAAC,CAEJ;AAGD,MAAMC,MAAM,GAAGd,YAAY,CAAC;EACxBe,OAAO,EAAEd,gBAAgB,CAAC,CAAC;EAC3BO;AACJ,CAAC,CAAC;AAEFM,MAAM,CAACE,UAAU,CAAC,CAACC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAClC,MAAMN,YAAY,GAAGI,EAAE,CAACG,OAAO,CAACC,IAAI,CAAEC,MAAM,IAAKA,MAAM,CAACV,IAAI,CAACC,YAAY,CAAC;EAC1E,MAAMU,YAAY,GAAGN,EAAE,CAACL,IAAI,CAACW,YAAY;EACzCrB,IAAI,CAACsB,kBAAkB,CAAEC,IAAI,IAAK;IAC9B,IAAIZ,YAAY,IAAI,CAACY,IAAI,EAAE;MACvB;MACAN,IAAI,CAAC,aAAa,CAAC;IACvB,CAAC,MAAM;MACH,IAAII,YAAY,IAAIE,IAAI,EAAE;QACtB,MAAMC,OAAO,GAAGpB,GAAG,CAACH,QAAQ,EAAG,SAAQsB,IAAI,CAACE,GAAI,OAAM,CAAC;QACvDpB,GAAG,CAACmB,OAAO,CAAC,CAACE,IAAI,CAAEC,QAAQ,IAAK;UAC5B,MAAMC,QAAQ,GAAGD,QAAQ,CAACE,GAAG,CAAC,CAAC;UAC/B,IAAID,QAAQ,KAAKP,YAAY,EAAE;YAC3B;YACAJ,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;UACf,CAAC,MAAM;YACHA,IAAI,CAAC,CAAC,CAAC,CAAC;UACZ;QACJ,CAAC,CAAC,CAACa,KAAK,CAAEC,KAAK,IAAK;UAChBC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;UACjDd,IAAI,CAAC,GAAG,CAAC;QACb,CAAC,CAAC;MACN,CAAC,MAAM;QACHA,IAAI,CAAC,CAAC,CAAC,CAAC;MACZ;IACJ;EACJ,CAAC,CAAC;AACN,CAAC,CAAC;AAIF,eAAeL,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}