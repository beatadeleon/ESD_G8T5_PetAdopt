{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport { auth, database } from '../firebaseConfig';\nimport Login from '../views/auth/Login.vue';\nimport Register from '../views/auth/Register.vue';\nconst routes = [{\n  path: '/auth/login',\n  name: 'login',\n  component: Login,\n  meta: {\n    requiresAuth: false\n  }\n}, {\n  path: '/auth/register',\n  name: 'Register',\n  component: Register,\n  meta: {\n    requiresAuth: false\n  }\n}, {\n  path: '/myDonations',\n  name: \"myDonations\",\n  component: myDonations,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/',\n  name: 'Home',\n  component: Home\n}, {\n  path: '/aboutUs',\n  name: 'aboutUs',\n  component: aboutUs\n}, {\n  path: '/auth/profile',\n  name: 'Profile',\n  component: profile,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/foodeve/creation',\n  name: 'createEvent',\n  component: createEvent,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodeve/trending',\n  name: 'foodEventsTrending',\n  component: trendingEvents,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/foodeve/:id',\n  name: \"foodEvent\",\n  component: FoodEvent,\n  // children: [\n  //     {\n  //         path: 'groupDonation/create',\n  //         name: 'createGroupDonation',\n  //         component: CreateGroupDonation,\n  //     }\n  // ],\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/search',\n  name: 'Search',\n  component: Search,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding',\n  name: 'Crowdfunding',\n  component: Crowdfunding,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/:id',\n  name: \"CrowdfundCheckout\",\n  component: CrowdfundCheckout,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/:id/success',\n  name: \"SuccessCrowdfund\",\n  component: SuccessCrowdfund,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/error',\n  name: \"ErrorCrowdfund\",\n  component: ErrorCrowdfund,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/crowdfunding/creation',\n  name: 'createCrowdfundingEvent',\n  component: createCrowdfundingEvent,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodeve/approve',\n  name: 'approveFoodDonation',\n  component: approveFoodEve,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodbank/delivery/create',\n  name: 'createDeliveryDriver',\n  component: deliveryDriverCreation,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'foodBank'\n  }\n}, {\n  path: '/foodeve/groupDonations/approve',\n  name: 'approveGroupRequestComponent',\n  component: approveGroupRequest,\n  meta: {\n    requiresAuth: true,\n    requiredRole: 'user'\n  }\n}, {\n  path: '/test',\n  name: 'test',\n  component: ImageUpload,\n  meta: {\n    requiresAuth: true\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\n  const requiredRole = to.meta.requiredRole;\n  auth.onAuthStateChanged(user => {\n    if (requiresAuth && !user) {\n      // If the route requires authentication and the user is not logged in, redirect to the login page\n      next('/auth/login');\n    } else {\n      if (requiredRole && user) {\n        const userRef = ref(database, `users/${user.uid}/role`);\n        get(userRef).then(snapshot => {\n          const userRole = snapshot.val();\n          //console.log(\"User Role from Database:\", userRole);\n          if (userRole !== requiredRole) {\n            //console.log(\"User doesn't have the required role, redirecting.\");\n            next('/');\n          } else {\n            //console.log(\"User has the required role, proceeding to the route.\");\n            next();\n          }\n        }).catch(error => {\n          //console.error(\"Error fetching user role:\", error);\n          next('/');\n        });\n      } else {\n        //console.log(\"No required role or no user role defined, proceeding to the route.\");\n        next();\n      }\n    }\n  });\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","auth","database","Login","Register","routes","path","name","component","meta","requiresAuth","myDonations","requiredRole","Home","aboutUs","profile","createEvent","trendingEvents","FoodEvent","Search","Crowdfunding","CrowdfundCheckout","SuccessCrowdfund","ErrorCrowdfund","createCrowdfundingEvent","approveFoodEve","deliveryDriverCreation","approveGroupRequest","ImageUpload","router","history","beforeEach","to","from","next","matched","some","record","onAuthStateChanged","user","userRef","ref","uid","get","then","snapshot","userRole","val","catch","error"],"sources":["/Users/junyi/Documents/petadopt/src/routes/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router';\nimport { auth, database } from '../firebaseConfig';\nimport Login from '../views/auth/Login.vue';\nimport Register from '../views/auth/Register.vue';\n\n\n\n\n\nconst routes = [\n    {\n        path: '/auth/login',\n        name: 'login',\n        component: Login,\n        meta: { requiresAuth: false },\n    },\n    {\n        path: '/auth/register',\n        name: 'Register',\n        component: Register,\n        meta: { requiresAuth: false },\n    },\n    {\n        path: '/myDonations',\n        name: \"myDonations\",\n        component: myDonations,\n        meta: { requiresAuth: true, requiredRole: 'user'},\n    },\n    {\n        path: '/',\n        name: 'Home',\n        component: Home,\n    },\n    {\n        path: '/aboutUs',\n        name: 'aboutUs',\n        component: aboutUs,\n\n    },\n    {\n        path: '/auth/profile',\n        name: 'Profile',\n        component: profile,\n        meta: { requiresAuth: true }\n    },\n    {\n        path: '/foodeve/creation',\n        name: 'createEvent',\n        component: createEvent,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodeve/trending',\n        name: 'foodEventsTrending',\n        component: trendingEvents,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/foodeve/:id',\n        name: \"foodEvent\",\n        component: FoodEvent,\n        // children: [\n        //     {\n        //         path: 'groupDonation/create',\n        //         name: 'createGroupDonation',\n        //         component: CreateGroupDonation,\n        //     }\n        // ],\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/search',\n        name: 'Search',\n        component: Search,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding',\n        name: 'Crowdfunding',\n        component: Crowdfunding,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/:id',\n        name: \"CrowdfundCheckout\",\n        component: CrowdfundCheckout,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/:id/success',\n        name: \"SuccessCrowdfund\",\n        component: SuccessCrowdfund,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/error',\n        name: \"ErrorCrowdfund\",\n        component: ErrorCrowdfund,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/crowdfunding/creation',\n        name: 'createCrowdfundingEvent',\n        component: createCrowdfundingEvent,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodeve/approve',\n        name: 'approveFoodDonation',\n        component: approveFoodEve,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodbank/delivery/create',\n        name: 'createDeliveryDriver',\n        component: deliveryDriverCreation,\n        meta: { requiresAuth: true, requiredRole: 'foodBank' },\n    },\n    {\n        path: '/foodeve/groupDonations/approve',\n        name: 'approveGroupRequestComponent',\n        component: approveGroupRequest,\n        meta: { requiresAuth: true, requiredRole: 'user' },\n    },\n    {\n        path: '/test',\n        name: 'test',\n        component: ImageUpload,\n        meta: { requiresAuth: true },\n    }\n]\n\n\nconst router = createRouter({ \n    history: createWebHistory(),\n    routes\n})\n\nrouter.beforeEach((to, from, next) => {\n    const requiresAuth = to.matched.some((record) => record.meta.requiresAuth);\n    const requiredRole = to.meta.requiredRole;\n    auth.onAuthStateChanged((user) => {\n        if (requiresAuth && !user) {\n            // If the route requires authentication and the user is not logged in, redirect to the login page\n            next('/auth/login');\n        } else {\n            if (requiredRole && user) {\n                const userRef = ref(database, `users/${user.uid}/role`);\n                get(userRef).then((snapshot) => {\n                    const userRole = snapshot.val();\n                    //console.log(\"User Role from Database:\", userRole);\n                    if (userRole !== requiredRole) {\n                        //console.log(\"User doesn't have the required role, redirecting.\");\n                        next('/');\n                    } else {\n                        //console.log(\"User has the required role, proceeding to the route.\");\n                        next();\n                    }\n                }).catch((error) => {\n                    //console.error(\"Error fetching user role:\", error);\n                    next('/');\n                });\n            } else {\n                //console.log(\"No required role or no user role defined, proceeding to the route.\");\n                next();\n            }\n        }\n    });\n})\n\n\nexport default router"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}